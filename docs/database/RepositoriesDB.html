<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_65) on Sat Jan 03 23:09:13 WET 2015 -->
<title>RepositoriesDB</title>
<meta name="date" content="2015-01-03">
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="RepositoriesDB";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-files/index-1.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../database/FilesDB.html" title="class in database"><span class="strong">Prev Class</span></a></li>
<li><a href="../database/UsersDB.html" title="class in database"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../index.html?database/RepositoriesDB.html" target="_top">Frames</a></li>
<li><a href="RepositoriesDB.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">database</div>
<h2 title="Class RepositoriesDB" class="title">Class RepositoriesDB</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>database.RepositoriesDB</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="strong">RepositoriesDB</span>
extends java.lang.Object</pre>
<div class="block">Repositories Database.
 Abstract representation of a repository database. It's composed by a
 OmniRepository HasSet, a HashMap that contains OmniRepository and unixtime
 stamp of the last heartbeat and a PriorityQueue that keeps OmniRepositories
 instances based on their availability (the least oberloaded with work repository
 stays on top of the queue). The HashSet was chosen to ensure uniqueness on
 connected repositories. The PriorityQueue was chosen because it orders
 repositories in a crescent based on the work they are doing.
 As for deleteBroadcast method, emphasizes the use of building Datagram Sockets
 inside, it is necessary to build as it travels through the collection of repositories
 in order to notify all of them to remove the file.

 Created by OmniBox on 08/11/14.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../database/RepositoriesDB.html#RepositoriesDB(server.OmniServer)">RepositoriesDB</a></strong>(<a href="../server/OmniServer.html" title="class in server">OmniServer</a>&nbsp;omniServer)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../database/RepositoriesDB.html#addRepo(shared.OmniRepository)">addRepo</a></strong>(<a href="../shared/OmniRepository.html" title="class in shared">OmniRepository</a>&nbsp;omniRepository)</code>
<div class="block">Add Repository

 Given an OmniRepository this method checks if the repository already
 exists.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../database/RepositoriesDB.html#deleteBroadcast(shared.Request)">deleteBroadcast</a></strong>(<a href="../shared/Request.html" title="class in shared">Request</a>&nbsp;response)</code>
<div class="block">Delete Broadcast

 Notifies all the repositories to remove a file</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../shared/OmniRepository.html" title="class in shared">OmniRepository</a></code></td>
<td class="colLast"><code><strong><a href="../database/RepositoriesDB.html#getDownloadSource(shared.OmniFile)">getDownloadSource</a></strong>(<a href="../shared/OmniFile.html" title="class in shared">OmniFile</a>&nbsp;omniFile)</code>
<div class="block">Get Download Source

 Checks if the less work loaded repository owns the file, and if not, checks for
 a repository where the file is hosted.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../shared/OmniRepository.html" title="class in shared">OmniRepository</a></code></td>
<td class="colLast"><code><strong><a href="../database/RepositoriesDB.html#getLessWorkLoadedRepository()">getLessWorkLoadedRepository</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../database/RepositoriesDB.html#getNumberOfReplicas(shared.OmniFile)">getNumberOfReplicas</a></strong>(<a href="../shared/OmniFile.html" title="class in shared">OmniFile</a>&nbsp;omniFile)</code>
<div class="block">Get Number of Replicas</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../database/RepositoriesDB.html#getNumberOfRepositories()">getNumberOfRepositories</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>java.util.HashSet&lt;<a href="../shared/OmniRepository.html" title="class in shared">OmniRepository</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../database/RepositoriesDB.html#getRepositories()">getRepositories</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../database/RepositoriesDB.html#removeExpiredRepositories()">removeExpiredRepositories</a></strong>()</code>
<div class="block">Remove Expired Repositories

 If the last communication time between the repository and the server is above
 the expected time, the repository should be removed - probably the repository
 is down.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../database/RepositoriesDB.html#replicationProcess(shared.OmniFile)">replicationProcess</a></strong>(<a href="../shared/OmniFile.html" title="class in shared">OmniFile</a>&nbsp;omniFile)</code>
<div class="block">Replication Process

 Given an OmniFile, this method selects (if exists) a source and a destination.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="RepositoriesDB(server.OmniServer)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>RepositoriesDB</h4>
<pre>public&nbsp;RepositoriesDB(<a href="../server/OmniServer.html" title="class in server">OmniServer</a>&nbsp;omniServer)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="addRepo(shared.OmniRepository)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addRepo</h4>
<pre>public&nbsp;void&nbsp;addRepo(<a href="../shared/OmniRepository.html" title="class in shared">OmniRepository</a>&nbsp;omniRepository)</pre>
<div class="block">Add Repository

 Given an OmniRepository this method checks if the repository already
 exists. If not, the rebuildFileSet is executed in order to assure that
 the file's collection remains updated. To keep the repository's collection
 updated the given repository is inserted after removing the old one, instead of
 updating based on performance analysis.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>omniRepository</code> - </dd></dl>
</li>
</ul>
<a name="getNumberOfRepositories()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getNumberOfRepositories</h4>
<pre>public&nbsp;int&nbsp;getNumberOfRepositories()</pre>
</li>
</ul>
<a name="getRepositories()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRepositories</h4>
<pre>public&nbsp;java.util.HashSet&lt;<a href="../shared/OmniRepository.html" title="class in shared">OmniRepository</a>&gt;&nbsp;getRepositories()</pre>
</li>
</ul>
<a name="removeExpiredRepositories()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>removeExpiredRepositories</h4>
<pre>public&nbsp;void&nbsp;removeExpiredRepositories()</pre>
<div class="block">Remove Expired Repositories

 If the last communication time between the repository and the server is above
 the expected time, the repository should be removed - probably the repository
 is down.</div>
</li>
</ul>
<a name="deleteBroadcast(shared.Request)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>deleteBroadcast</h4>
<pre>public&nbsp;void&nbsp;deleteBroadcast(<a href="../shared/Request.html" title="class in shared">Request</a>&nbsp;response)</pre>
<div class="block">Delete Broadcast

 Notifies all the repositories to remove a file</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>response</code> - </dd></dl>
</li>
</ul>
<a name="replicationProcess(shared.OmniFile)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>replicationProcess</h4>
<pre>public&nbsp;void&nbsp;replicationProcess(<a href="../shared/OmniFile.html" title="class in shared">OmniFile</a>&nbsp;omniFile)</pre>
<div class="block">Replication Process

 Given an OmniFile, this method selects (if exists) a source and a destination.
 Source is a repository that hosts the requested OmniFile, and the destination
 is a repository where the file does not exist. An UDP notification is sent to
 to the source in order to upload the file to the destination.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>omniFile</code> - </dd></dl>
</li>
</ul>
<a name="getDownloadSource(shared.OmniFile)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getDownloadSource</h4>
<pre>public&nbsp;<a href="../shared/OmniRepository.html" title="class in shared">OmniRepository</a>&nbsp;getDownloadSource(<a href="../shared/OmniFile.html" title="class in shared">OmniFile</a>&nbsp;omniFile)</pre>
<div class="block">Get Download Source

 Checks if the less work loaded repository owns the file, and if not, checks for
 a repository where the file is hosted.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>omniFile</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>the Repository that hosts the file and at the same time is dealing with
 a lower number of operations.</dd></dl>
</li>
</ul>
<a name="getNumberOfReplicas(shared.OmniFile)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getNumberOfReplicas</h4>
<pre>public&nbsp;int&nbsp;getNumberOfReplicas(<a href="../shared/OmniFile.html" title="class in shared">OmniFile</a>&nbsp;omniFile)</pre>
<div class="block">Get Number of Replicas</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>omniFile</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>the number of repositories that host the file</dd></dl>
</li>
</ul>
<a name="getLessWorkLoadedRepository()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getLessWorkLoadedRepository</h4>
<pre>public&nbsp;<a href="../shared/OmniRepository.html" title="class in shared">OmniRepository</a>&nbsp;getLessWorkLoadedRepository()</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-files/index-1.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../database/FilesDB.html" title="class in database"><span class="strong">Prev Class</span></a></li>
<li><a href="../database/UsersDB.html" title="class in database"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../index.html?database/RepositoriesDB.html" target="_top">Frames</a></li>
<li><a href="RepositoriesDB.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
